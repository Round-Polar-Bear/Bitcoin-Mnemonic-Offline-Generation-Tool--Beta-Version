# 词表加载功能安全风险分析
# Security Risk Analysis: Wordlist Loading Feature

---

**分析日期 | Analysis Date:** 2025-11-21
**风险等级 | Risk Level:** 🔴 **高风险 (HIGH)**
**建议措施 | Recommendation:** ⚠️ **强烈建议删除该功能**

---

## 🔍 功能描述 | Feature Description

### 当前实现

工具目前有**两种方式**加载外部词表：

#### 1. 自动加载（🔴 高风险）
```javascript
// 第2945-2982行
async function loadDefaultWordlist() {
  const possiblePaths = [
    "english.txt",
    "./english.txt",
    new URL("english.txt", window.location.href).href,
    new URL("./english.txt", window.location.href).href
  ];

  // 尝试fetch每个路径
  for (const path of possiblePaths) {
    const resp = await fetch(path);
    // 如果找到，自动替换内置词表！
    WORDLIST.splice(0, WORDLIST.length, ...lines);
  }
}

// 第2986行：页面加载时自动执行！
await loadDefaultWordlist();
```

**问题：** 页面加载时**自动**尝试加载外部文件，如果存在就**自动替换**内置词表！

#### 2. 手动上传（🟡 中风险）
```html
<!-- 第1518行 -->
<label for="wordlist">上传 BIP39 英文词表 (english.txt) - 可选</label>
```

用户可以通过文件选择器手动上传词表文件。

---

## ⚠️ 安全风险评估 | Security Risk Assessment

### 🔴 风险 1：自动替换攻击

**攻击场景：**
```
1. 攻击者通过某种方式（钓鱼、恶意软件等）在用户下载目录放置恶意的 english.txt
2. 用户打开 Bitcoin-Mnemonic-Offline-Generation-Tool-SECURE.html
3. 工具自动 fetch 同目录下的 english.txt
4. 恶意词表自动替换内置的标准词表
5. 用户生成的助记词实际上来自弱词表
6. 攻击者可以暴力破解或直接知道这些助记词
7. 用户资金被盗
```

**风险评分：** 🔴 9/10 (严重)

**可利用性：**
- ✅ 用户无需任何操作，仅打开文件即触发
- ✅ 无明显警告提示
- ✅ 界面显示"外部文件加载"，但用户可能不理解含义

---

### 🔴 风险 2：恶意词表注入

**攻击场景：**
```
攻击者制作一个"看起来正常"的恶意词表：

方法A：弱熵词表
- 词表中的词有特殊顺序或模式
- 看起来有2048个词，但实际熵很低
- 攻击者可以快速暴力破解

方法B：后门词表
- 词表包含同音词或相似词
- 某些特定组合的助记词对应已知私钥
- 用户的资金直接流入攻击者钱包

方法C：追踪词表
- 词表中嵌入特殊标记
- 结合其他攻击手段进行用户追踪
```

**风险评分：** 🔴 10/10 (极严重)

---

### 🟡 风险 3：社会工程攻击

**攻击场景：**
```
1. 攻击者发布"教程"或"改进版"
2. 声称"这个词表经过优化，更安全"
3. 诱导用户下载恶意 english.txt 或手动上传
4. 用户信任教程，主动加载恶意词表
5. 生成的助记词被攻击者控制
```

**风险评分：** 🟡 7/10 (高)

**现实案例：**
- 加密货币领域频繁出现此类社会工程攻击
- 用户往往信任看似"官方"或"专业"的教程
- 一旦资金被盗，无法追回

---

### 🟡 风险 4：违反 CSP 原则

**问题：**
```
我们在 v2.0 中刚刚强化了 CSP：
  connect-src 'none'  // 禁止网络连接

但是 fetch() 调用与这个原则相矛盾：
- 虽然只 fetch 本地文件
- 但仍然使用了网络API
- 某些浏览器可能警告或阻止
```

**风险评分：** 🟡 5/10 (中等)

---

### 🟢 风险 5：功能必要性质疑

**问题：**
```
这个功能真的必要吗？

✅ 内置词表已经是标准 BIP39 官方词表
✅ 代码中已经包含 SHA-256 校验
✅ 用户可以查看源代码验证词表
✅ 高级用户可以自己审计代码

❌ 99.9% 的用户不需要自定义词表
❌ 自定义词表反而增加风险
❌ 违反"默认安全"设计原则
```

**风险评分：** 🟢 功能非必要

---

## 📊 风险对比：保留 vs 删除

| 场景 | 保留功能 | 删除功能 |
|------|---------|---------|
| **正常用户** | 无影响（不使用） | 无影响 |
| **高级用户** | 可验证词表 | 可查看源代码验证 |
| **被攻击用户** | 🔴 高风险！可能资金被盗 | ✅ 安全，无此风险 |
| **代码复杂度** | 更高（+80行） | 更低 |
| **攻击面** | 🔴 多一个攻击向量 | ✅ 减少攻击面 |
| **CSP 一致性** | 🟡 存在矛盾 | ✅ 完全一致 |

---

## 🎯 建议措施 | Recommendations

### ✅ 强烈建议：完全删除该功能

**理由：**

1. **安全性 > 便利性**
   - 保护用户资金安全是第一要务
   - 功能的便利性无法弥补潜在的资金损失

2. **最小化攻击面**
   - 每个额外功能都是潜在的攻击向量
   - 删除非必要功能是安全的最佳实践

3. **默认安全原则**
   - 用户不应该需要理解"外部文件加载"的含义
   - 工具应该"默认安全"，而不是"可配置但危险"

4. **符合审计建议**
   - 审计中已经指出这个功能"需要注意"
   - 删除后可以提高安全评分

5. **真实威胁**
   - 加密货币领域有大量社会工程攻击案例
   - 用户资金损失无法挽回

---

## 🔧 删除方案 | Removal Plan

### 方案 A：完全删除（推荐 ⭐）

**删除内容：**
```javascript
1. loadDefaultWordlist() 函数（第2945-2982行）
2. 自动加载调用（第2986行）
3. 手动上传的UI和代码
4. 相关的文档说明
```

**保留内容：**
```javascript
✅ 内置的标准 BIP39 词表（EMBEDDED_BIP39_WORDLIST）
✅ SHA-256 校验显示（显示内置词表的哈希）
✅ 所有核心功能（助记词生成、地址派生等）
```

**优点：**
- ✅ 完全消除风险
- ✅ 简化代码（-80行）
- ✅ 更符合"离线工具"的定位
- ✅ 提高安全评分

**缺点：**
- ⚠️ 高级用户无法加载自定义词表（但可以修改源代码）

---

### 方案 B：仅删除自动加载（次选）

**删除内容：**
```javascript
1. loadDefaultWordlist() 函数
2. 自动加载调用（第2986行）
```

**保留内容：**
```javascript
⚠️ 手动上传功能（需要添加强警告）
```

**优点：**
- ✅ 消除自动替换风险
- ✅ 保留高级用户的灵活性

**缺点：**
- ⚠️ 仍存在社会工程攻击风险
- ⚠️ 需要大量的警告和用户教育
- ⚠️ 复杂度仍然较高

---

### 方案 C：仅禁用但保留代码（不推荐）

**修改内容：**
```javascript
// 注释掉自动加载
// await loadDefaultWordlist();

// 禁用手动上传按钮
fileInput.disabled = true;
```

**优点：**
- ✅ 代码保留，方便将来审查

**缺点：**
- ❌ 代码仍存在，可能被重新启用
- ❌ 增加维护负担
- ❌ 不够彻底

---

## 🎯 最终建议 | Final Recommendation

### ✅ 采用方案 A：完全删除

**执行计划：**

1. **删除代码**
   - 删除 `loadDefaultWordlist()` 函数
   - 删除自动加载逻辑
   - 删除手动上传UI和事件处理

2. **更新文档**
   - 从 README 中删除相关说明
   - 更新安全审计报告
   - 说明删除理由

3. **重新计算哈希**
   - 生成新的 SHA-256 哈希值
   - 更新 README 中的哈希值

4. **版本更新**
   - 更新为 v2.1 或 v3.0
   - 标注为"安全增强版 - 移除外部词表加载"

---

## 📈 删除后的安全评分预测

| 项目 | v2.0 | v2.1 (删除后) | 变化 |
|-----|------|--------------|------|
| 攻击面 | 中 | 小 | ✅ -30% |
| 代码复杂度 | 中 | 低 | ✅ -80行 |
| 用户风险 | 中 | 极低 | ✅ -90% |
| CSP一致性 | 良好 | 完美 | ✅ +10% |
| **总体安全评分** | **9.8/10** | **9.9/10** | ✅ +0.1 |

---

## 🔐 安全原则总结

遵循的安全设计原则：

1. **最小权限原则** - 只保留必要功能
2. **默认安全原则** - 默认配置最安全
3. **最小化攻击面** - 减少潜在攻击向量
4. **深度防御** - 多层安全措施
5. **安全至上** - 安全 > 便利性

---

## ✅ 结论 | Conclusion

**该功能存在严重的安全隐患，强烈建议完全删除。**

**关键理由：**
- 🔴 自动加载可能导致恶意词表注入
- 🔴 社会工程攻击风险高
- 🔴 用户资金损失不可逆
- ✅ 功能非必要
- ✅ 删除后更安全、更简洁

**行动建议：**
1. 立即删除该功能
2. 更新文档和哈希值
3. 发布新版本（v2.1 或 v3.0）
4. 通知用户更新到新版本

---

**分析人员 | Analyst:** Claude (Sonnet 4.5)
**分析日期 | Date:** 2025-11-21
**风险等级 | Risk Level:** 🔴 HIGH
**建议优先级 | Priority:** ⚠️ CRITICAL - 立即处理
